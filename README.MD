# Vodyani winston

**@vodyani/winston** æ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æœåŠ¡ç«¯æ—¥å¿—å·¥å…· ğŸ¯

[![Npm](https://img.shields.io/npm/v/@vodyani/winston/latest.svg)](https://www.npmjs.com/package/@vodyani/winston)
[![Npm](https://img.shields.io/npm/v/@vodyani/winston/beta.svg)](https://www.npmjs.com/package/@vodyani/winston)
[![Npm](https://img.shields.io/npm/dm/@vodyani/winston)](https://www.npmjs.com/package/@vodyani/winston)
[![License](https://img.shields.io/github/license/vodyani/winston)](LICENSE)
<br>
[![codecov](https://codecov.io/gh/vodyani/winston/branch/master/graph/badge.svg?token=MCD6EGYBHA)](https://codecov.io/gh/vodyani/winston)
![Workflow](https://github.com/vodyani/winston/actions/workflows/release.yml/badge.svg)
[![semantic-release: angular](https://img.shields.io/badge/semantic--release-angular-e10079?logo=semantic-release)](https://github.com/semantic-release/semantic-release)

[ğŸ‘‰ğŸ» Maybe you need english document.](./docs/en.readme.md)

## å®‰è£…æ–¹æ³•

```sh
npm install @vodyani/winston
```

## ä½¿ç”¨æ–¹æ³•

### ä½¿ç”¨ LoggerFactory åˆ›å»º Logger

```ts
import { LoggerFactory } from '@vodyani/winston';

const factory = new LoggerFactory().create({
  env: 'LOCAL',
  name: 'logger',
  mode: ['Console'],
});

logger.log('');
logger.info('output info');
logger.debug('output debug');
logger.warn('output warn', 'logger');
logger.error(new Error('this is error'), 'output error', 'logger');
```

### LoggerFactory.create çš„å‚æ•°

|å‚æ•°|å‚æ•°ç±»å‹|å‚æ•°æè¿°|æ˜¯å¦å¿…ä¼ |é»˜è®¤å€¼|ç¤ºä¾‹|
|:-:|:-:|:-:|:-:|:-:|:-:|
|env|string|æ—¥å¿—çš„ç¯å¢ƒå˜é‡|âœ…|-|'LOCAL'|
|name|string|æ—¥å¿—åç§°|âœ…|-|'logger'|
|mode|string[]|æ—¥å¿—çš„è¾“å‡ºæ¨¡å¼ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œç›®å‰åªæ”¯æŒï¼š'Console' è¾“å‡ºåˆ°æ§åˆ¶å°ã€'File' è¾“å‡ºåˆ°æ–‡ä»¶ã€'DailyRotateFile' è¾“å‡ºåˆ°æ¯æ—¥è½®è½¬æ–‡ä»¶|âœ…|-|'Console'|
|levelDict|object|æ—¥å¿—ç­‰çº§åˆ«åæ˜ å°„ï¼Œè¿™ä¸ªå‚æ•°åœ¨æ˜ å°„æ—¥å¿—æ–‡ä»¶åçš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼š[æ—¥å¿—ç­‰çº§æ˜ å°„æœºåˆ¶](#æ—¥å¿—ç­‰çº§æ˜ å°„æœºåˆ¶)|â|`{ error: 'error', access: 'debug' }`|`{ error: 'error', access: 'debug' }`|
|consoleOptions|object|è¾“å‡ºåˆ°æ§åˆ¶å°çš„é…ç½®|â|-|[æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston/blob/master/docs/transports.md#console-transport)|
|fileOptions|object|è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶çš„é…ç½®|â|[æŸ¥çœ‹æœ‰å“ªäº›é»˜è®¤å€¼](#fileoptions-å‚æ•°çš„è¡¥å……è¯´æ˜)|[æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston/blob/master/docs/transports.md#file-transport)|
|dailyRotateFileOptions|object|è¾“å‡ºåˆ°æ¯æ—¥è½®è½¬æ—¥å¿—æ–‡ä»¶çš„é…ç½®|â|[æŸ¥çœ‹æœ‰å“ªäº›é»˜è®¤å€¼](#dailyrotatefileoptions-å‚æ•°çš„è¡¥å……è¯´æ˜)|[æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston-daily-rotate-file#options)|
|levels|array|æ—¥å¿—ç­‰çº§è¡¨|â|[æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston#logging)|-|
|format|object|æ ¼å¼åŒ–å·¥å…·|â|[æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston#formats)|-|
|transports|array|æ—¥å¿—è¾“å‡ºå™¨|â|[æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://github.com/winstonjs/winston/blob/master/docs/transports.md)|-|
|exitOnError|boolean|å¦‚æœä¸º `false`ï¼Œæ‰€å¤„ç†çš„å¼‚å¸¸å°†ä¸ä¼šå¯¼è‡´ `process.exit`ï¼Œå¹¶ä¸”è§¦å‘[æœªæ•æ‰å¼‚å¸¸çš„å¤„ç†æœºåˆ¶](#æœªæ•æ‰å¼‚å¸¸çš„å¤„ç†æœºåˆ¶)|â|true|-|
|silent|boolean|æ˜¯å¦é™é»˜|â|false|-|

#### æ—¥å¿—ç­‰çº§æ˜ å°„æœºåˆ¶

ç°åœ¨ï¼Œç”±äºå¼•å…¥äº†åˆ«åæ˜ å°„æœºåˆ¶ï¼Œ`consoleOptions`ã€`fileOptions`ã€`dailyRotateFileOptions` ä¸æ”¯æŒæ‚¨è®¾ç½® level å‚æ•°

åŒæ ·çš„ï¼Œ`LoggerFactory` çš„ `create` æ–¹æ³•ä¹Ÿä¸å…è®¸è®¾ç½® level å‚æ•°

- åœ¨åˆ›å»º Logger æ—¶ï¼Œå¦‚æœ `mode` å‚æ•°åŒ…å« 'Console' é€‰é¡¹ï¼Œæ„å»ºå™¨å°†éå† `levelDict` å‚æ•°ï¼Œè®©æ˜ å°„çš„ `å±æ€§å€¼` ä½œä¸ºè¾“å‡ºå™¨çš„æ—¥å¿—ç­‰çº§
- åœ¨åˆ›å»º Logger æ—¶ï¼Œå¦‚æœ `mode` å‚æ•°åŒ…å« 'File' é€‰é¡¹ï¼Œæ„å»ºå™¨å°†éå† `levelDict` å‚æ•°ï¼Œè®©æ˜ å°„çš„ `å±æ€§é”®` ä½œä¸ºæ—¥å¿—æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œ`å±æ€§å€¼` ä½œä¸ºè¾“å‡ºå™¨çš„æ—¥å¿—ç­‰çº§
- åœ¨åˆ›å»º Logger æ—¶ï¼Œå¦‚æœ `mode` å‚æ•°åŒ…å« 'DailyRotateFile' é€‰é¡¹ï¼Œæ„å»ºå™¨å°†éå† `levelDict` å‚æ•°ï¼Œè®©æ˜ å°„çš„ `å±æ€§é”®` ä½œä¸ºæ—¥å¿—æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œ`å±æ€§å€¼` ä½œä¸ºè¾“å‡ºå™¨çš„æ—¥å¿—ç­‰çº§

#### æœªæ•æ‰å¼‚å¸¸çš„å¤„ç†æœºåˆ¶

å½“ `exitOnError` ä¸º false æ—¶ï¼Œå¼€å¯å¼‚å¸¸å¤„ç†ï¼Œå°†é»˜è®¤å¼€å¯ `handleExceptions` å’Œ `handleRejections`

- å†…éƒ¨çš„æ„å»ºå™¨å°†ä¼šæŠŠ levelDict ä¸­å€¼ä¸º `error` çš„ `transport` æ·»åŠ åˆ° `rejectionHandlers` å’Œ `exceptionHandlers` æ•°ç»„ä¸­
- `rejectionHandlers` å’Œ `exceptionHandlers` åœ¨ä¸€ä¸ªæ—¥å¿—å¤„ç†å™¨ä¸­ï¼Œåªä¼šå„è‡ªæœ‰ä¸€ä¸ª `error transport`
- `error transport` çš„è®¾ç½®ä¼˜å…ˆçº§ä¸ºï¼š`DailyRotateFile` > `File` > `Console`

#### fileOptions å‚æ•°çš„è¡¥å……è¯´æ˜

1. é»˜è®¤å€¼

- dirnameï¼Œé»˜è®¤æ˜¯ `logs` ç›®å½•
- filenameï¼Œé»˜è®¤å°†ç”± `æ—¥å¿—å+æ—¥å¿—ç­‰çº§åˆ«å` ç»„æˆ

ä¸‹é¢çš„ä¼ªä»£ç æ˜¯æ¼”ç¤ºåœ¨å¯ç”¨ `'File'` æ¨¡å¼åï¼Œé»˜è®¤å€¼çš„å¡«å……è¿‡ç¨‹ï¼š

```js
Object.keys(levelDict).forEach(key => {
  const level = levelDict[key];

  fileOptions.dirname = './logs';
  fileOptions.filename = `${name}.${key}.log`;

  // fileTransport.level = level
});
```

2. è‡ªå®šä¹‰æ–‡ä»¶å

å½“æ‚¨å¸Œæœ›è‡ªå®šä¹‰æ–‡ä»¶åï¼Œéœ€è¦ä¼ å…¥ customFilename å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±æ‚¨è‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°

ä¸‹é¢å°†åˆ›å»ºä¸€æ®µä¼ªä»£ç ï¼Œæ¥æ¼”ç¤ºåœ¨å¯ç”¨ `'File'` æ¨¡å¼åï¼Œé»˜è®¤å€¼çš„å¡«å……è¿‡ç¨‹ï¼š

```js
Object.keys(levelDict).forEach(key => {
  const level = levelDict[key];

  fileOptions.dirname = './logs';
  fileOptions.filename = fileOptions.customFilename
    ? fileOptions.customFilename(key)
    : `${name}.${key}.log`;

  // fileTransport.level = level
});
```

#### dailyRotateFileOptions å‚æ•°çš„è¡¥å……è¯´æ˜

1. é»˜è®¤å€¼

- dirnameï¼Œé»˜è®¤æ˜¯ `logs` ç›®å½•
- filenameï¼Œé»˜è®¤å°†ç”± `æ—¥æœŸ+æ—¥å¿—å+æ—¥å¿—ç­‰çº§åˆ«å` ç»„æˆ

ä¸‹é¢çš„ä¼ªä»£ç æ˜¯æ¼”ç¤ºåœ¨å¯ç”¨ `'DailyRotateFile'` æ¨¡å¼åï¼Œé»˜è®¤å€¼çš„å¡«å……è¿‡ç¨‹ï¼š

```js
Object.keys(levelDict).forEach(key => {
  const level = levelDict[key];

  dailyRotateFileOptions.dirname = './logs';
  dailyRotateFileOptions.filename = `%DATE%-${name}.${key}.log`;

  // fileTransport.level = level
});
```

2. è‡ªå®šä¹‰æ–‡ä»¶å

å½“æ‚¨å¸Œæœ›è‡ªå®šä¹‰æ–‡ä»¶åï¼Œéœ€è¦ä¼ å…¥ customFilename å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±æ‚¨è‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°

ä¸‹é¢å°†åˆ›å»ºä¸€æ®µä¼ªä»£ç ï¼Œæ¥æ¼”ç¤ºåœ¨å¯ç”¨ `'DailyRotateFile'` æ¨¡å¼åï¼Œé»˜è®¤å€¼çš„å¡«å……è¿‡ç¨‹ï¼š

```js
Object.keys(levelDict).forEach(key => {
  const level = levelDict[key];

  dailyRotateFileOptions.dirname = './logs';
  dailyRotateFileOptions.filename = dailyRotateFileOptions.customFilename
    ? dailyRotateFileOptions.customFilename(key)
    : `%DATE%-${name}.${key}.log`;

  // fileTransport.level = level
});
```

## å¼€å‘å›¢é˜Ÿ

|[![ChoGathK](https://github.com/chogathK.png?size=100)](https://github.com/chogathK)|
|:-:|
|[ChoGathK](https://github.com/chogathK)|

## License

Vodyani winston is [MIT licensed](LICENSE).
